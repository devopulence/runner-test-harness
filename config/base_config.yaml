# Base Configuration
# Shared configuration that applies to all environments
# Environment-specific configs override these settings

app:
  name: GitHub Runner Performance Test Harness
  version: 1.0.0
  description: Portable testing harness for GitHub runners with 4-runner constraint

# GitHub API configuration
github_api:
  base_url: https://api.github.com
  api_version: "2022-11-28"

  # Rate limiting
  rate_limit:
    primary: 5000      # Authenticated requests per hour
    secondary: 60      # Unauthenticated requests per hour

  # Retry configuration
  retry:
    max_attempts: 5
    backoff_factor: 2
    max_backoff: 60

  # Headers
  headers:
    Accept: "application/vnd.github.v3+json"
    X-GitHub-Api-Version: "2022-11-28"

# Test execution defaults
test_execution:
  # Default timeout for workflow completion (seconds)
  workflow_timeout: 3600  # 1 hour

  # How often to poll for workflow status (seconds)
  poll_interval: 30

  # Maximum number of workflows to track simultaneously
  max_concurrent_tracking: 20

  # Delay between dispatching workflows (seconds)
  dispatch_delay: 5

  # Enable detailed progress tracking
  verbose: true

# Performance testing parameters
performance_testing:
  # Warmup period before collecting metrics (seconds)
  warmup_duration: 300  # 5 minutes

  # Cooldown period after test (seconds)
  cooldown_duration: 180  # 3 minutes

  # Statistical significance threshold
  confidence_level: 0.95

  # Minimum sample size for valid results
  min_sample_size: 10

# Test types and their characteristics
test_types:
  performance:
    description: "Baseline performance measurement"
    objective: "Establish normal operating metrics"
    key_metrics:
      - average_queue_time
      - average_execution_time
      - throughput

  scalability:
    description: "Test system scalability"
    objective: "Determine how system handles increasing load"
    key_metrics:
      - queue_time_vs_load
      - throughput_scaling
      - resource_utilization

  load:
    description: "Sustained load testing"
    objective: "Verify system stability under expected load"
    key_metrics:
      - sustained_throughput
      - error_rate
      - response_time_consistency

  stress:
    description: "Stress testing beyond normal capacity"
    objective: "Find breaking points and failure modes"
    key_metrics:
      - maximum_throughput
      - failure_point
      - recovery_time

  spike:
    description: "Sudden load spike testing"
    objective: "Test system response to traffic spikes"
    key_metrics:
      - spike_queue_time
      - recovery_duration
      - jobs_dropped

  volume:
    description: "Large volume data processing"
    objective: "Test handling of large artifacts/data"
    key_metrics:
      - data_throughput
      - memory_usage
      - disk_io

  capacity:
    description: "Maximum capacity determination"
    objective: "Find absolute limits with 4-runner constraint"
    key_metrics:
      - max_concurrent_jobs
      - saturation_point
      - efficiency_at_capacity

# Metrics calculation
metrics:
  # Percentiles to calculate
  percentiles:
    - 50  # Median
    - 75
    - 90
    - 95
    - 99

  # Time buckets for histograms (seconds)
  time_buckets:
    - 30
    - 60
    - 120
    - 300
    - 600
    - 900
    - 1200
    - 1800

  # Aggregation windows (seconds)
  aggregation_windows:
    short: 60      # 1 minute
    medium: 300    # 5 minutes
    long: 900      # 15 minutes

# Output formats
output:
  # Available output formats
  formats:
    - json
    - yaml
    - csv
    - html
    - markdown

  # Timestamp format
  timestamp_format: "%Y-%m-%d %H:%M:%S UTC"

  # Decimal precision for metrics
  decimal_precision: 2

# Validation rules
validation:
  # Minimum runners required
  min_runners: 4

  # Maximum test duration (seconds)
  max_test_duration: 14400  # 4 hours

  # Required GitHub token permissions
  required_permissions:
    - repo
    - workflow
    - actions:read

# Error handling
error_handling:
  # Continue test on workflow failure
  continue_on_failure: true

  # Maximum consecutive failures before abort
  max_consecutive_failures: 5

  # Error notification
  notification:
    enabled: false
    methods:
      - console
      - logfile

# Data persistence
persistence:
  # Store raw data for later analysis
  store_raw_data: true

  # Data retention (days)
  retention_days: 30

  # Database configuration (optional)
  database:
    enabled: false
    type: sqlite
    path: test_results/metrics.db

# Comparison and baselining
comparison:
  # Enable baseline comparison
  baseline_comparison: true

  # Baseline file location
  baseline_path: baselines/

  # Threshold for performance regression (%)
  regression_threshold: 10

  # Threshold for performance improvement (%)
  improvement_threshold: 10

# Visualization defaults
visualization:
  # Chart dimensions
  chart_width: 800
  chart_height: 600

  # Color scheme
  color_scheme: "default"

  # Export formats
  export_formats:
    - png
    - svg
    - pdf

# Debug settings
debug:
  # Enable debug mode
  enabled: false

  # Save API responses
  save_api_responses: false

  # Log API requests
  log_api_requests: false

  # Simulate mode (don't actually trigger workflows)
  simulate: false