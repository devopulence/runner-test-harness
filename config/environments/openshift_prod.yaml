# OpenShift Production Environment Configuration
# This configuration is for running tests against production OpenShift runners

environment:
  name: openshift-prod
  description: OpenShift Production GitHub Runners
  type: production
  cluster: prod-cluster-1
  namespace: github-runners

github:
  owner: Devopulence  # Update with your actual GitHub org
  repo: pythonProject # Update with your actual repo
  # Runner labels for OpenShift environment
  runner_labels:
    - self-hosted
    - openshift
    - linux
    - production

runners:
  count: 4  # Hard limit - exactly 4 runners
  type: openshift-pod

  # OpenShift pod resources
  resources:
    requests:
      cpu: "1"
      memory: "2Gi"
    limits:
      cpu: "2"
      memory: "4Gi"

  # Expected startup time for runners (seconds)
  startup_time: 90  # OpenShift pods may take longer

  # Maximum job duration before timeout (seconds)
  max_job_duration: 3600  # 1 hour

workflows:
  directory: .github/workflows/realistic

  # Same workflows but might have different behavior in OpenShift
  available:
    - name: build_job
      file: build_job.yml
      description: Simulates CI build process
      default_inputs:
        workload_type: standard
        enable_randomization: true

    - name: deployment_pipeline
      file: deployment_pipeline.yml
      description: Simulates deployment to environments
      default_inputs:
        environment: production  # Different default for prod
        deployment_size: large    # Larger deployments in prod
        enable_randomization: true

    - name: security_scan
      file: security_scan.yml
      description: Simulates security scanning
      default_inputs:
        scan_depth: comprehensive  # More thorough in prod
        enable_randomization: true

    - name: multi_stage_pipeline
      file: multi_stage_pipeline.yml
      description: Complex multi-job pipeline
      default_inputs:
        pipeline_complexity: complex  # Full pipeline in prod
        parallelism_strategy: mixed
        enable_randomization: true

    - name: container_pipeline
      file: container_pipeline.yml
      description: Container build and push simulation
      default_inputs:
        build_type: full-stack      # Full stack in prod
        registry_type: dockerhub    # Your actual registry
        enable_randomization: true
        include_scanning: true      # Always scan in prod

test_profiles:
  # Performance baseline test - adjusted for production
  performance:
    duration_minutes: 30
    workflows:
      - build_job
    dispatch_pattern: steady
    jobs_per_minute: 0.3      # Lower rate for production

  # Capacity test - careful in production
  capacity:
    duration_minutes: 30      # Shorter duration in prod
    workflows:
      - build_job
      - deployment_pipeline
    dispatch_pattern: steady
    jobs_per_minute: 0.8      # Don't overload production

  # Stress test - limited in production
  stress:
    duration_minutes: 20      # Shorter in production
    workflows:
      - multi_stage_pipeline
    dispatch_pattern: burst
    burst_size: 6             # Smaller burst in production
    burst_interval: 600       # Every 10 minutes

  # Load test - production realistic load
  load:
    duration_minutes: 60      # Shorter than test environment
    workflows:
      - build_job
      - deployment_pipeline
      - security_scan
    dispatch_pattern: steady
    jobs_per_minute: 0.6      # Conservative load

  # Spike test - production spike simulation
  spike:
    duration_minutes: 30
    workflows:
      - build_job
    dispatch_pattern: spike
    normal_rate: 0.2
    spike_rate: 1.0           # Lower spike in production
    spike_duration: 300       # 5 minute spike
    spike_start: 600          # Start at 10 minutes

# Metrics to collect
metrics:
  collection_interval: 60     # Less frequent in production

  github_api:
    enabled: true
    endpoints:
      - workflow_runs
      - jobs
      - runners

  # OpenShift-specific metrics
  openshift_metrics:
    enabled: true
    collect:
      - pod_cpu_usage
      - pod_memory_usage
      - pod_restart_count
      - persistent_volume_usage

  custom_metrics:
    - queue_time
    - execution_time
    - runner_utilization
    - throughput
    - failure_rate
    - docker_build_time      # Docker-in-Docker metrics
    - artifact_size

# Reporting configuration
reporting:
  format: json
  output_directory: test_results/openshift_prod

  report_types:
    - summary
    - detailed
    - comparison
    - production_impact    # Special report for production

  visualization:
    enabled: true
    charts:
      - queue_time_histogram
      - runner_utilization_timeline
      - throughput_chart
      - job_duration_distribution
      - openshift_resource_usage

  # Alert on issues in production
  alerts:
    enabled: true
    thresholds:
      queue_time_p95: 600        # Alert if 95th percentile > 10 min
      failure_rate: 0.1          # Alert if > 10% failures
      runner_utilization: 0.95   # Alert if > 95% utilized

# Network configuration for corporate environment
network:
  proxy:
    enabled: true
    http_proxy: "http://proxy.company.com:8080"    # Update with your proxy
    https_proxy: "http://proxy.company.com:8080"   # Update with your proxy
    no_proxy: "localhost,127.0.0.1,.company.com"

  ssl:
    verify: true
    ca_bundle: "/etc/pki/ca-trust/source/anchors/company-ca.crt"  # Update path

  timeout:
    api_call: 60          # Longer timeout for corporate network
    workflow_dispatch: 120

# OpenShift-specific configuration
openshift:
  # Service account for accessing OpenShift API
  service_account: github-runner-sa

  # OpenShift API endpoint
  api_endpoint: https://api.openshift.company.com:6443  # Update with your endpoint

  # Namespace where runners are deployed
  namespace: github-runners

  # Route to access runners (if exposed)
  route: github-runners.apps.openshift.company.com

  # Storage for artifacts and caches
  storage:
    persistent_volume_claim: runner-storage-pvc
    size: 100Gi

# Logging configuration
logging:
  level: INFO
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: logs/openshift_prod_test.log
  console: true

  # Send logs to centralized logging
  centralized:
    enabled: true
    endpoint: "syslog://logging.company.com:514"  # Update with your endpoint

  rotation:
    max_bytes: 10485760
    backup_count: 10      # Keep more in production

# Safety settings for production
safety:
  dry_run: false                    # Set to true for test runs
  max_concurrent_workflows: 6        # Limit concurrent workflows
  cooldown_between_tests: 300        # 5 min cooldown between test profiles
  abort_on_high_failure_rate: true   # Stop if failure rate > 25%
  require_confirmation: true          # Require confirmation before starting